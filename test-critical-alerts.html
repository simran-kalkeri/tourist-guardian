<!DOCTYPE html>
<html>
<head>
    <title>Critical Alerts Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .alert { background: #fee; border: 1px solid #fcc; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; font-family: monospace; white-space: pre; }
    </style>
</head>
<body>
    <h1>Critical Alerts Test</h1>
    <button onclick="fetchAlerts()">Fetch Critical Alerts</button>
    <div id="results"></div>

    <script>
        async function fetchAlerts() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="debug">Fetching...</div>';

            try {
                console.log('üîç Fetching critical alerts...');
                const response = await fetch('http://localhost:5000/api/geofencing/critical-alerts');
                console.log('üì° Response status:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ Response data:', data);

                let html = `<div class="debug">‚úÖ SUCCESS: Fetched ${data.alerts?.length || 0} critical alerts (Count: ${data.count})</div>`;
                
                if (data.alerts && data.alerts.length > 0) {
                    html += '<h2>üö® TOURISTS CURRENTLY IN HIGH-RISK ZONES:</h2>';
                    data.alerts.forEach((alert, index) => {
                        html += `
                            <div class="alert">
                                <strong>üö® Alert #${index + 1}</strong><br>
                                Tourist: <strong>${alert.touristName || alert.touristId}</strong><br>
                                Zone: <strong>${alert.zones?.[0]?.name || 'Unknown'}</strong> (${alert.zones?.[0]?.risk_level || alert.alertLevel} risk)<br>
                                Location: ${alert.latitude?.toFixed(4)}, ${alert.longitude?.toFixed(4)}<br>
                                Entry Time: ${new Date(alert.timestamp).toLocaleString()}<br>
                                Status: ${alert.status}<br>
                                Event: ${alert.eventType}<br>
                                Message: ${alert.description || alert.message}
                            </div>
                        `;
                    });
                } else {
                    html += '<div class="debug">‚úÖ No tourists currently in high-risk zones</div>';
                }
                
                resultsDiv.innerHTML = html;
            } catch (error) {
                console.error('‚ùå Error:', error);
                resultsDiv.innerHTML = `<div class="debug">‚ùå ERROR: ${error.message}</div>`;
            }
        }
        
        // Auto-refresh every 5 seconds
        setInterval(fetchAlerts, 5000);

        // Auto-fetch on page load
        window.onload = fetchAlerts;
    </script>
</body>
</html>